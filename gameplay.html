<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Game</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="object"></div>
    <div id="container">
        <h1>Bouncing Ball</h1>
        <button id="start">Start Game</button>
        <label for="slider">Speed: <span id="speed"></span></label>
        <input type="range" min="1" max="10" value="5.5" step="0.1" id="slider">
    </div>
    <button id="stop">Stop</button>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        //Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCHvwXIji75oFVqTHqTSTXN4Mrw_8Cqtg8",
            authDomain: "bouncing-ball-rw.firebaseapp.com",
            databaseURL: "https://bouncing-ball-rw-default-rtdb.firebaseio.com",
            projectId: "bouncing-ball-rw",
            storageBucket: "bouncing-ball-rw.appspot.com",
            messagingSenderId: "353355833704",
            appId: "1:353355833704:web:afcd68b1b8ab1fc9d3b6dd",
            measurementId: "G-4DN6DJKY30"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const object = document.getElementById("object");
        let isActive = false;

        // Set the initial speed value
        const slider = document.getElementById("slider");
        const speedValue = document.getElementById("speed");
        let moveSpeed = slider.value;
        speedValue.textContent = moveSpeed - 0.5;

        // Update the speed value when the slider is moved
        slider.addEventListener("input", function () {
            moveSpeed = slider.value;
            speedValue.textContent = moveSpeed;
        });

        let screenWidth = window.innerWidth;
        function centerObject() {
            const initialLeft = (screenWidth - object.offsetWidth) / 2;
            object.style.left = `${initialLeft}px`;
        }
        centerObject();

        function handleOrientation(gamma) {
            // Determine movement direction based on gamma value
            let direction = gamma > 5 ? 1 : gamma < -5 ? -1 : 0;

            // Update object's position at a constant speed
            const currentLeft = parseInt(object.style.left, 10);
            let newLeft = currentLeft + (moveSpeed * direction);

            // Ensure the object remains within screen bounds
            newLeft = Math.max(0, Math.min(screenWidth - object.offsetWidth, newLeft));

            object.style.left = `${newLeft}px`;
        }

        const dbRef = ref(database, 'orientationData');
        onValue(dbRef, (snapshot) => {
            if (!isActive) return;
            const data = snapshot.val();
            handleOrientation(data.orientation);
        });

        const button = document.getElementById("start");
        const stopButton = document.getElementById("stop");
        const container = document.getElementById("container");

        button.addEventListener("click", function (e) {
            e.preventDefault();
            isActive = !isActive;
            container.style.display = "none";
            stopButton.style.display = "block";
        });

        stopButton.addEventListener("click", function (e) {
            e.preventDefault();
            isActive = !isActive;
            container.style.display = "flex";
            stopButton.style.display = "none";
            centerObject();
            set(ref(database, 'orientationData'), {
                orientation: 0
            });
        });

        window.addEventListener('resize', () => {
            screenWidth = window.innerWidth;
            centerObject();
        });
    </script>
</body>

</html>